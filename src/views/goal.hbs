<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goal</title>
    <link rel="stylesheet" href="/css/goal.css">
   
</head>
<body>
    <div class="phone">
        <button class="open-button" onclick="openForm()">Add Goal</button>
        <div class="form-popup" id="myForm">
          <form class="form-container" action="/goal" method="post">
            <input type="text" name="goalname" placeholder="Enter Goal" required>
            <input type="number" name="goalbudget" placeholder="Enter Budget" required>
            <input type="date" name="gdate" class="dateg">
            <button type="submit" class="btn" onclick="closeForm()">ADD</button>
          </form>
        </div>
            {{#if msg}}
                <p class="{{msg_type}}">{{msg}}</p>
            {{/if}} 
        <div class="newscroll">
            <h4>Goals:</h4>
            <div class="trip-inner">
              {{#if goals}}
                {{#each goals}}
                <div class="inner">
                  <p>Goal : <span>{{this.name}}</span></p>
                  <p>Target amount : <span>{{this.target_amount}}</span> </p>
                  <p>Deadline : <span> {{this.deadline}} </span> </p>
                  <div class="inner-btnsflex">
                  <form style="display:inline" method="post" action="/goal/delete">
                    <input type="hidden" name="goalId" value="{{this._id}}">
                    <button type="submit" class="icon-btn delete-btn" style="margin-right:8px" title="Delete">Delete</button>
                  </form>
                    <button class="icon-btn edit-btn" onclick='editGoal("{{this._id}}","{{this.name}}","{{this.target_amount}}","{{this.deadline}}")' title="Edit">Edit</button>
                  </div>
                  </div>
                </div>
                {{/each}}
              {{/if}}
            </div>
            {{> navbar}}
        </div>
    </div>

    <script>
        function openForm() {
        document.getElementById("myForm").style.display = "block";

      }

        function closeForm() {
         document.getElementById("myForm").style.display = "none";
        }
        function editGoal(id, name, amount, deadline) {
          const newName = prompt('Goal name', name) || name;
          const newAmount = prompt('Target amount', amount) || amount;
          const newDate = prompt('Deadline (YYYY-MM-DD)', deadline) || deadline;

          const form = document.createElement('form');
          form.method = 'post';
          form.action = '/goal/update';

          const add = (n, v) => {
            const i = document.createElement('input');
            i.type = 'hidden';
            i.name = n;
            i.value = v;
            form.appendChild(i);
          }
          add('goalId', id);
          add('goalname', newName);
          add('goalbudget', newAmount);
          add('gdate', newDate);

          document.body.appendChild(form);
          form.submit();
        }
    </script>
</body>
</html>
